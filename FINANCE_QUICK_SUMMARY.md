# النظام المالي - ملخص سريع
# Finance System - Quick Summary

## 💡 بكل بساطة

النظام المالي = **دفتر الحسابات** اللي بيسجل:
- 💰 كل صيدلية مديونة بكام
- 🏪 كل مورد أنت مديون له بكام
- 📝 كل معاملة مالية (شراء، بيع، دفعات)

---

## 🏦 الحساب (Account)

### كل مستخدم عنده حساب:

```json
{
  "user": "صيدلية النور",
  "balance": -15000,           // ⬅️ مديونة 15,000 جنيه
  "credit_limit": 50000,       // ⬅️ ممكن تدين لحد 50,000
  "remaining_credit": 35000    // ⬅️ باقي ليها 35,000 تدين زيادة
}
```

**قراءة الرصيد:**
- `balance = -15000` → الصيدلية **مديونة** 15,000 جنيه لك
- `balance = +5000` → الصيدلية **دافعة زيادة** 5,000 جنيه (رصيد موجب)
- `balance = 0` → **متعادلة** (لا دائن ولا مدين)

---

## 📊 المعاملات المالية

### أنواع المعاملات:

| النوع | متى تحدث | التأثير على رصيد الصيدلية |
|-------|----------|---------------------------|
| **Sale Invoice** (فاتورة بيع) | الصيدلية تشتري منك | ➖ يزيد الدين |
| **Sale Payment** (دفعة من صيدلية) | الصيدلية تدفع لك | ➕ يقل الدين |
| **Sale Return** (مرتجع بيع) | الصيدلية ترجع بضاعة | ➕ يقل الدين |
| **Purchase Invoice** (فاتورة شراء) | أنت تشتري من مورد | ➕ يزيد دينك للمورد |
| **Purchase Payment** (دفعة للمورد) | أنت تدفع للمورد | ➖ يقل دينك |
| **Purchase Return** (مرتجع شراء) | أنت ترجع للمورد | ➖ يقل دينك |

---

## 💰 مثال: حساب صيدلية النور

### البداية
```
balance = 0  (لا دائن ولا مدين)
```

### 1. الصيدلية اشترت منك بضاعة بـ 20,000 جنيه
```
فاتورة بيع → SALE_INVOICE
balance = 0 - 20,000 = -20,000

👉 الصيدلية مديونة 20,000 جنيه
```

### 2. الصيدلية دفعت 8,000 جنيه
```
دفعة بيع → SALE_PAYMENT
balance = -20,000 + 8,000 = -12,000

👉 لسه مديونة 12,000 جنيه
```

### 3. الصيدلية اشترت تاني بـ 5,000 جنيه
```
فاتورة بيع → SALE_INVOICE
balance = -12,000 - 5,000 = -17,000

👉 مديونة 17,000 جنيه
```

### 4. الصيدلية رجعت بضاعة معيبة بـ 2,000 جنيه
```
مرتجع بيع → SALE_RETURN
balance = -17,000 + 2,000 = -15,000

👉 مديونة 15,000 جنيه
```

### 5. الصيدلية دفعت 15,000 جنيه
```
دفعة بيع → SALE_PAYMENT
balance = -15,000 + 15,000 = 0

👉 متعادلة ✅ (سددت كل الديون)
```

---

## 📋 APIs الأساسية

### عرض حسابات الصيدليات
```http
GET http://129.212.140.152/finance/accounts/
```

### عرض معاملات حساب معين
```http
GET http://129.212.140.152/finance/account-transactions/?account=5
```

### تسجيل دفعة من صيدلية
```http
POST http://129.212.140.152/finance/sale-payments/create/
{
  "user": 5,
  "method": "cash",
  "amount": 5000,
  "at": "2025-10-10",
  "remarks": "دفعة على الحساب"
}
```

### تسجيل دفعة لمورد
```http
POST http://129.212.140.152/finance/purchase-payments/create/
{
  "user": 3,
  "method": "instapay",
  "amount": 10000,
  "at": "2025-10-10",
  "remarks": "سداد فاتورة 4601"
}
```

---

## 🔔 التنبيهات التلقائية

### تحذير الحد الائتماني
```
إذا: remaining_credit < 5000
→ ⚠️ الصيدلية قربت توصل للحد الائتماني!
```

### منع البيع
```
إذا: remaining_credit <= 0
→ ❌ لا يمكن البيع للصيدلية (وصلت للحد الأقصى)
```

---

## 📊 تقارير مفيدة

### 1. الصيدليات الأكثر ديوناً
```http
GET /finance/accounts/?o=-balance
```

### 2. الصيدليات القريبة من الحد الائتماني
```http
GET /finance/accounts/?o=remaining_credit
```

### 3. معاملات اليوم
```http
GET /finance/account-transactions/?at__date=2025-10-10
```

---

## 🎯 ملخص نهائي

```
النظام المالي يسجل تلقائياً:

✅ كل فاتورة بيع → دين على الصيدلية
✅ كل دفعة من صيدلية → يقل الدين
✅ كل فاتورة شراء → دين عليك للمورد
✅ كل دفعة للمورد → يقل دينك

النتيجة:
📊 تعرف كل صيدلية مديونة بكام
📊 تعرف كل مورد مديون له بكام
📊 تعرف الرصيد الإجمالي
📊 تمنع البيع للصيدليات اللي وصلت الحد الائتماني
```

---

**للتفاصيل الكاملة**: راجع [finance/FINANCE_SYSTEM_GUIDE.md](./finance/FINANCE_SYSTEM_GUIDE.md)

---

**آخر تحديث**: 2025-10-10

