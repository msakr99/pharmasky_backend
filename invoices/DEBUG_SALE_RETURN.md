# ุญู ูุดููุฉ: ูุงุชูุฑุฉ ุงูุฅุฑุฌุงุน ุบูุฑ ููุฌูุฏุฉ
# Fix: Sale Return Invoice Not Found

## ๐ ุงููุดููุฉ | The Problem

```json
{
  "invoice": [
    "ูุนุฑู ุงูุนูุตุฑ \"1\" ุบูุฑ ุตุงูุญ - ุงูุนูุตุฑ ุบูุฑ ููุฌูุฏ."
  ]
}
```

**ุนูุฏ:**
```json
POST /invoices/sale-return-invoice-items/create/
{
  "invoice": 1,
  "sale_invoice_item": 2,
  "quantity": 8
}
```

---

## ๐ ุงูุณุจุจ ุงููุญุชูู | Possible Causes

### 1. ูุงุชูุฑุฉ ุงูุฅุฑุฌุงุน ุบูุฑ ููุฌูุฏุฉ
```python
# ูุง ููุฌุฏ SaleReturnInvoice with id=1
```

### 2. ูุงุชูุฑุฉ ุงูุฅุฑุฌุงุน ูุบููุฉ
```python
# SaleReturnInvoice with id=1 has status='closed'
# ูุงูู queryset ูุณุชุจุนุฏ ุงูููุงุชูุฑ ุงููุบููุฉ:
queryset=SaleReturnInvoice.objects.exclude(
    status=SaleReturnInvoiceStatusChoice.CLOSED
)
```

---

## โ ุงูุญู | Solution

### ุงูุฎุทูุฉ 1: ุชุญูู ูู ูุฌูุฏ ูุงุชูุฑุฉ ุงูุฅุฑุฌุงุน

```bash
GET http://129.212.140.152/invoices/sale-return-invoices/1/
```

**ุฅุฐุง ูุงูุช ููุฌูุฏุฉ:**
```json
{
  "id": 1,
  "status": "closed",  // โ ูุบููุฉ!
  ...
}
```

**ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ:**
```json
{
  "detail": "Not found."
}
```

---

### ุงูุฎุทูุฉ 2: ุงูุญููู ุญุณุจ ุงูุญุงูุฉ

#### ุงูุญุงูุฉ ุฃ: ุงููุงุชูุฑุฉ ุบูุฑ ููุฌูุฏุฉ โ

**ุงูุญู:** ุฃูุดุฆ ูุงุชูุฑุฉ ุฅุฑุฌุงุน ุฃููุงู:

```bash
POST http://129.212.140.152/invoices/sale-return-invoices/create/
{
  "user": 5,  // ููุณ ุงููุณุชุฎุฏู ูู ูุงุชูุฑุฉ ุงูุจูุน
  "items": [
    {
      "sale_invoice_item": 2,
      "quantity": 8
    }
  ]
}
```

**Response:**
```json
{
  "id": 1,  // โ ูุงุชูุฑุฉ ุฅุฑุฌุงุน ุฌุฏูุฏุฉ
  "user": {...},
  "items": [...],
  "status": "placed"
}
```

---

#### ุงูุญุงูุฉ ุจ: ุงููุงุชูุฑุฉ ููุฌูุฏุฉ ููู ูุบููุฉ โ

**ุงูุญู 1:** ุงูุชุญ ุงููุงุชูุฑุฉ ุงููุบููุฉ (ุฅู ุฃููู):
```bash
PATCH http://129.212.140.152/invoices/sale-return-invoices/1/change-state/
{
  "status": "placed"
}
```

**ุงูุญู 2:** ุฃูุดุฆ ูุงุชูุฑุฉ ุฅุฑุฌุงุน ุฌุฏูุฏุฉ:
```bash
POST http://129.212.140.152/invoices/sale-return-invoices/create/
{
  "user": 5,
  "items": [
    {
      "sale_invoice_item": 2,
      "quantity": 8
    }
  ]
}
```

---

#### ุงูุญุงูุฉ ุฌ: ุงููุงุชูุฑุฉ ููุฌูุฏุฉ ูููุชูุญุฉ โ

**ููููู ุฅุถุงูุฉ ุงูุนูุตุฑ ูุจุงุดุฑุฉ:**
```bash
POST http://129.212.140.152/invoices/sale-return-invoice-items/create/
{
  "invoice": 1,
  "sale_invoice_item": 2,
  "quantity": 8
}
```

---

## ๐ ููู ุชุชุญูู | How to Check

### ุชุญูู ูู ุงูููุงุชูุฑ ุงููุชุงุญุฉ:

```bash
GET http://129.212.140.152/invoices/sale-return-invoices/
```

**ุณูุนุฑุถ ูู:**
```json
{
  "results": [
    {
      "id": 1,
      "status": "placed",  // โ ุฃู "closed" โ
      "user": {...}
    }
  ]
}
```

---

### ุชุญูู ูู ูุงุชูุฑุฉ ูุนููุฉ:

```bash
GET http://129.212.140.152/invoices/sale-return-invoices/1/
```

---

## ๐ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ | Correct Way

### ุงูุณููุงุฑูู 1: ุฅูุดุงุก ูุงุชูุฑุฉ ุฅุฑุฌุงุน ูุงููุฉ

```bash
POST /invoices/sale-return-invoices/create/
{
  "user": 5,
  "items": [
    {
      "sale_invoice_item": 2,
      "quantity": 8
    }
  ]
}
```

**ุงูููุงุฆุฏ:**
- โ ูุชู ุฅูุดุงุก ุงููุงุชูุฑุฉ ูุงูุนูุงุตุฑ ูุนุงู
- โ ูุง ุญุงุฌุฉ ููุนุฑูุฉ ID ุงููุงุชูุฑุฉ ูุณุจูุงู

---

### ุงูุณููุงุฑูู 2: ุฅุถุงูุฉ ุนูุตุฑ ููุงุชูุฑุฉ ููุฌูุฏุฉ

```bash
# 1. ุชุฃูุฏ ูู ูุฌูุฏ ูุงุชูุฑุฉ ุฅุฑุฌุงุน ููุชูุญุฉ
GET /invoices/sale-return-invoices/?user=5&status=placed

# 2. ุฅุฐุง ูุฌุฏุช ูุงุชูุฑุฉ (ูุซูุงู ID=1)
POST /invoices/sale-return-invoice-items/create/
{
  "invoice": 1,
  "sale_invoice_item": 2,
  "quantity": 8
}
```

---

## โ๏ธ ุงูุดุฑูุท ุงููุทููุจุฉ | Required Conditions

ูุฅุถุงูุฉ ุนูุตุฑ ููุงุชูุฑุฉ ุฅุฑุฌุงุนุ ูุฌุจ:

### 1. ูุงุชูุฑุฉ ุงูุฅุฑุฌุงุน:
- โ ููุฌูุฏุฉ
- โ ุญุงูุชูุง `placed` (ููุณุช `closed`)
- โ ูููุณ ุงููุณุชุฎุฏู

### 2. ุนูุตุฑ ูุงุชูุฑุฉ ุงูุจูุน:
- โ ูู ูุงุชูุฑุฉ ุจูุน ูุบููุฉ (`closed`)
- โ `remaining_quantity > 0`
- โ ุงูููุชุฌ ููุณ ูู ุงูุซูุงุฌุฉ (`fridge=False`)

---

## ๐ฏ ุงูุญู ุงูุณุฑูุน | Quick Fix

ุฅุฐุง ูู ุชูู ูุชุฃูุฏุงูุ ุงุณุชุฎุฏู **ุทุฑููุฉ ุงูุฅูุดุงุก ุงููุงููุฉ**:

```bash
POST http://129.212.140.152/invoices/sale-return-invoices/create/
{
  "user": 5,
  "items": [
    {
      "sale_invoice_item": 2,
      "quantity": 8
    }
  ]
}
```

**ุณูููู ุจู:**
1. โ ุฅูุดุงุก ูุงุชูุฑุฉ ุฅุฑุฌุงุน ุฌุฏูุฏุฉ
2. โ ุฅุถุงูุฉ ุงูุนูุตุฑ ุฅูููุง
3. โ ุฅุฑุฌุงุน ุงููุงุชูุฑุฉ ุงููุงููุฉ ูุน ุงูุนูุงุตุฑ

---

## ๐ ููุงุญุธุงุช | Notes

- ูุงุชูุฑุฉ ุงูุฅุฑุฌุงุน ูููุตูุฉ ุนู ูุงุชูุฑุฉ ุงูุจูุน
- ูููู ุฃู ูููู ูููุณุชุฎุฏู ุฃูุซุฑ ูู ูุงุชูุฑุฉ ุฅุฑุฌุงุน
- ููุท ุงูููุงุชูุฑ ุงูููุชูุญุฉ (`placed`) ูููู ุฅุถุงูุฉ ุนูุงุตุฑ ููุง

---

ุฌุฑุจ ุงูุทุฑููุฉ ุงููุงููุฉ ุฃููุงู! ๐


